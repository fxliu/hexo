---
title: 视频
tags: 
    - rtsp
categories: 
    - Android
description: rtsp
date: 2023-04-21 11:20:35
updated: 2023-04-21 11:20:35
---

## 播放器

+ [ijkplayer](https://github.com/bilibili/ijkplayer)
  + 支持Android, IOS
  + 基于FFmpeg的开源播放器
+ [fanplayer](https://github.com/rockcarry/fanplayer)

## RTSP

+ [SampleIjkplayerRtspPlay](https://github.com/zxrmmxt/SampleIjkplayerRtspPlay)
  + 基于`ijkplayer`的Android RTST播放Demo
+ [NodeMediaClient-Android](https://github.com/NodeMedia/NodeMediaClient-Android)
  + 简单, 高效, 低延迟的直播SDK

### SampleIjkplayerRtspPlay

+ 参数配置
```java
// RTSP参数: IjkVideoView.java -> createPlayer
// 协议
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, "rtsp_transport", "tcp");
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, "rtsp_transport", "udp");
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "rtsp_transport", 0);
// 硬解码
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "mediacodec", 1);
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "mediacodec-auto-rotate", 0);
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "mediacodec-handle-resolution-change", 0);
// 加速 范围[0.5, 2]
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "soundtouch_enable", 1);
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "soundtouch", 1);
// ijkMediaPlayer.setSpeed(2);

// 设置播放前的探测时间 1,达到首屏秒开效果
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, "analyzeduration", 1);
// 等待开始之后才绘制
//ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "render-wait-start", 1);
// 设置播放前的最大探测时间 （100未测试是否是最佳值）
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, "analyzemaxduration", 100);
// 通过立即清理数据包来减少等待时长
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_FORMAT, "flush_packets", 1L);
// 需要准备好后自动播放
// ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "start-on-prepared", 0);
// 是否开启预缓冲，一般直播项目会开启，达到秒开的效果，不过带来了播放丢帧卡顿的体验
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "packet-buffering", 0);
// 网络卡顿时, 允许丢掉视频帧
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "framedrop", 1);
// 去掉音频帧
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER, "an", 1);
// 不查询stream_info，直接使用
ijkMediaPlayer.setOption(IjkMediaPlayer.OPT_CATEGORY_PLAYER,"find_stream_info", 0);
```

+ 添加控件到UI
```xml
<com.es.rtsp.widget.IjkVideoView
    android:id="@+id/video_view"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```

+ 应用
```java
public class RtspActivity extends AppCompatActivity {
    private RtspPlayer mRtspPlayer;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_rtsp);
        getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);

        mRtspPlayer = new RtspPlayer();
        mRtspPlayer.init(this, new RtspPlayer.BaseLoadingView() {
            @Override
            public void showLoading() {

            }

            @Override
            public void dismissLoading() {

            }
        });
    }

    @Override
    protected void onResume() {
        super.onResume();
        if (mRtspPlayer != null)
            mRtspPlayer.startPlay("rtsp://192.168.0.200:8554/live");
    }

    @Override
    protected void onPause() {
        super.onPause();
        if (mRtspPlayer != null)
            mRtspPlayer.stopPlay();
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
        if (mRtspPlayer != null)
            mRtspPlayer.release();
    }
}
```
