---
title: Gradle
tags: 
    - Gradle
categories: 
    - Android
description: Gradle
date: 2022-03-21 09:36:18
updated: 2022-03-21 09:36:18
---

## 安装

+ [官网](https://developer.android.google.cn/)下载安装包
+ [AndroidStudio使用](https://developer.android.google.cn/studio/intro)
+ 新建工程，下载默认gradle

### gradle

[gradle手动下载路径](https://services.gradle.org/distributions/)
[gradle版本号对应](https://developer.android.google.cn/studio/releases/gradle-plugin#revisions)

+ 打开项目的时候有时候会卡在"refreshing gradle project"
+ 打开工程文件"gradle\wrapper\gradle-wrapper.properties", 里面指明了gradle的版本
+ 本地路径`C:\Users\lfx\.gradle\wrapper\dists\gradle-5.4.1-all\3221gyojl5jsh0helicew7rwx`
  + gradle-5.4.1-all.zip
  + gradle-5.4.1
    + bin
    + docs
    + lib
    + samples
    + getting-started.html
    + ...
    
## 补充第三方镜像

```java
// 依赖包下载镜像
// maven: https://mvnrepository.com/
allprojects {
    repositories {
        jcenter()
        google()
        mavenCentral()
        maven { url 'https://maven.aliyun.com/repository/google'}
        maven { url 'https://maven.aliyun.com/repository/jcenter'}
        maven { url 'http://maven.aliyun.com/nexus/content/groups/public'}
        maven { url 'https://jitpack.io' }
    }
}
```

## 参数配置
```java
// 根目录创建 pro.gradle
ext {
    signingConfig = [
            storeFile : file('..\\..\\key\\release.keystore'),
            storePassword: 'es.dnndo',
            keyAlias: 'es.eidsdk',
            keyPassword: 'es.dnndo',
    ]

    appVersionCode = 33
    appVersionName = '3.3.2'

    sdkVersionName = '2.2.3'
}

// 或者修改根目录 gradle.properties
appVersionCode = 33
appVersionName = '3.3.2'

sdkVersionName = '2.2.3'
```

```java
// 根目录创建 build.gradle 引入
apply from: "pro.gradle"
buildscript {...}
allprojects {...}

// 可以再app -> build.gradle 使用
android {
    defaultConfig {
        versionCode project.appVersionCode
        versionName "${project.appVersionName}"
    }
    signingConfigs {
        release {
            storeFile project.signingConfig['storeFile']
            storePassword project.signingConfig['storePassword']
            keyAlias project.signingConfig['keyAlias']
            keyPassword project.signingConfig['keyPassword']
        }
    }
}
```

## 签名配置

```java
// app.gradle
android {
    signingConfigs {
        release {
            storeFile file('..\\..\\key\\release.keystore')
            storePassword 'es.dnndo'
            keyAlias 'es.eidsdk'
            keyPassword 'es.dnndo'
        }
    }
}
// app -> build.gradle
apply from: "app.gradle"
android {
    buildTypes {
        debug {
            signingConfig signingConfigs.release
        }
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release
        }
    }
}
```

## Jni编译参数配置
```java

android {
    buildTypes {
        release {
            externalNativeBuild {
                cmake {
                    // 添加宏 NDEBUG, 隐藏符号
                    cppFlags '-DNDEBUG -fvisibility-inlines-hidden -fvisibility=hidden -fno-common'
                    // 编译参数 包含 -DNDEBUG 
                    arguments "-DCMAKE_BUILD_TYPE=Release"
                }
            }
        }
    }
}
```

## 第三方库 - 区分加载

```java
android {
    sourceSets {
        main {
            // 指定JNI目录
            jniLibs.srcDirs = ['libs', 'src/main/jni']
        }
    }
}
dependencies {
    debugImplementation project(path: ':lib_eidnfs_sdk')
    releaseImplementation files("libs/lib_eidnfs_sdk-1.0.aar")
}
```

## 工程引用

```java
// settings.gradle
rootProject.name = "***"
include ':app'
include ':my_module'
project(':my_module').projectDir = new File('子模块路径')
```
